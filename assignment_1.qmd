---
title: "assignment_1"
format: html
editor: visual
bibliography: [MSB104.bib, MSB104_Assignment.bib, MSB104_Assignment1.bib]
author: Marius Martinussen, Espen Knutsen og Asbjørn Gaard
---

```{r}
#| label: setup
#| output: false
#| message: false
#| echo: false
library(eurostat)
library(dineq)
library(readr)
library(tidyverse)
library(stringr)
library(huxtable)
library(vtable)
library(ggplotify)
library(grid)
library(dplyr)
library(gridExtra)
library(ggplot2)
library(broom)
library(lmtest)
library(plm)
```

## Part A: Sub-national GDP and GDP per capita

### 1. Data acquisition

By using Eurostat, we have downloaded data containing GDP and population for each country in the EU from year 1990 to 2023.
However, we are only interested in the following countries from 2000 to 2020:

### Countries of interest

-   Italy
-   Sweden
-   Belgium
-   Austria
-   Croatia
-   Serbia
-   Bosnia and Herzegovina
-   Bulgaria
-   Germany

Below is a short extract of the raw datasets from Eurostat.

```{r, show_col_types = FALSE}
#| echo: FALSE
#| output: FALSE
#| label: Datasets and variable mutations
# Loading datasets
# Country code list: "IT", "SE", "BE", "AT", "HR", "RS", "BA", "BG", "DE")
# 
nama_10r_3gdp_linear_csv <- read_csv("nama_10r_3gdp_linear.csv.gz", 
    na = "NA")
demo_r_pjanaggr3_linear_csv <- read_csv("demo_r_pjanaggr3_linear.csv.gz", 
    na = "NA")
roads <- read_csv("roads.gz")
educ <- read_csv("educ.gz")
aream2 <- read_csv("aream2.gz")

# Subset of countries from 2000 to 2020
# Filtering geo = 5 to only get NUTS3 level data
gdp_filtered <- nama_10r_3gdp_linear_csv |> 
  filter(
    nchar(geo) == 5, 
    unit == "MIO_EUR", 
      TIME_PERIOD %in% c(2000:2020),
    str_sub(geo, start = 1L, end = 2L) %in% c("IT", "SE", "BE", "AT", "HR", "RS", "BA", "BG", "DE")
    ) |> 
  select(
    year = TIME_PERIOD, 
    geo, GDP = OBS_VALUE
    ) 

# Filtering population demo for nuts3 countries and years
# Filtering sex = T to only get the total of both genders
# Filtering age = TOTAL.
pop <- demo_r_pjanaggr3_linear_csv |> 
    filter(
      nchar(geo) == 5,
      sex == "T",
      age == "TOTAL",
      TIME_PERIOD %in% c(2000:2020), 
    str_sub(geo, start = 1L, end = 2L) %in% c("IT", "SE", "BE", "AT", "HR", "RS", "BA", "BG", "DE")
    ) |> 
  select(
    year = TIME_PERIOD, 
    geo, Population = OBS_VALUE
    ) 

# Merging the two datasets
merged_data <- merge(gdp_filtered, pop, by = "geo") |> 
  select(
    -year.y,
    Year = year.x,)

# merging the two datasets from eurostat and removing NA and zero values
merged_data <- merge(gdp_filtered, pop, by = c("geo","year"), all = TRUE) |> 
filter(!is.na(Population),
         Population != 0,
         GDP != 0, 
         GDP != "NA"
)
# Generating the GDP per capita variable
merged_data <- merged_data |> 
  mutate(
    GDPpcn3 = GDP / Population
  )
# Adding GDP variable by deviding gdp on population
merged_data <- merged_data |> 
  mutate(GDPpcn3 = (GDP / Population)*1000000)

# Calculating GINI in nuts3 data for nuts2 regions to measure inequity on a nuts2 scale
merged_data <- merged_data |> 
 mutate(
    nuts2 = substr(geo, 1,4),
    nuts0 = substr(geo, 1,2)
 )

# Cleaning the road dataset by removing irrelevant data and NA values
roads <- roads |> 
  select(
    nuts2 = geo, Roadkm = OBS_VALUE, year = TIME_PERIOD
  ) 
roads <- roads |>
  filter(
    !is.na(Roadkm),
    Roadkm != 0
  ) 
# Cleaning education dataset renaming variables
educ <- educ |> 
  filter(sex == "T") |> 
  select(
    nuts2 = geo, age, year = TIME_PERIOD, education = OBS_VALUE, level = isced11
  ) |> 
  filter(nuts2 != "NA", age != "NA", year != "NA", education != "NA")
  
# We are only looking for data for College education (ED5-8) and we devide education by 100 to get the percentages on percentage form.
educ <- educ |> 
  mutate(
    education = education/100
  ) |> 
  filter(level == "ED5-8") 

# Aream2 refers to the dataset containing area data for each nuts3 region measured in squared kilometres
aream2 <- aream2 |>
    mutate(
    year2 = 2010
  ) |> 
   select(
    nuts2 = geo, year = year2, area = OBS_VALUE
  ) 
# We noticed the dataset contained age groups, and two of those groups contained much of the same data: age 25-34 and 30-34. This created issues as some of these observations would be counted twice. We therefore decied to remove the group 30-34.
educ <- educ |> 
  filter(
    !age %in% "Y30-34"
  ) |> 
  mutate(
     nuts2 = substr(nuts2, 1,4),
  ) |> 
  group_by(nuts2) |> 
  mutate(
    sumeduc = sum(education, na.rm = TRUE)
  ) |> 
    slice(1) |> 
    ungroup() |> 
  select(-age)




```

```{r}
#| echo: FALSE
nama_10r_3gdp_linear_csv |> 
    print(
    n = 5,
    width = 80
  )

demo_r_pjanaggr3_linear_csv |> 
  print(
    n = 5,
    width = 80
  )

```

\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\-\--

## Description

The first dataset we downloaded from Eurostat was **demo_r_pjanaggr3,** which contains population data from Europe.
In our case, we have selected population data from Sweden, Italy, Belgium, Austria, Croatia, Serbia, Bosnia and Herzegovina, Germany.
According to @eurostat2021, the dataset of demography is a set of statistical numbers each country in Europe sends yearly to Eurostat by 31 December of the following calendar year.
Furthermore, the definition of "population" is, according to @eurostat2021, all persons having their residences in a member state, including all live births and deaths during the year when the statistical numbers are heading to Eurostat.
Moreover, the demographic data at a regional level are separated into different groups named NUTS, which are defined as nomenclature for territorial units for statistics [@eurostat2021].
The purpose of the NUTS function is to subdivide the territory of the European Union into 104 regions at NUTS level 1 and break it down by to 281 at NUTS level 2 and 1348 at NUTS level 3 [@eurostat2021].
In the beginning of this paper, we have focused on the numbers of NUTS 3 level, but the dataset containing population data has been broken down by sex and broad age groups (0-14, 15-64 and 65 or more).

The following dataset we downloaded from Eurostat was the **nama_10r_3gdp dataset**.
Furthermore, this dataset is also broken down to NUTS level 3 which focus on GDP data from the sub-regions in Sweden, Italy, Belgium, Austria, Croatia, Serbia, Bosnia and Herzegovina, Germany.
According to @eurostat2023, GDP (Gross domsetsic product) at market prices is defined as the final result of the production activity of resident producer units [@eurostat2023].

**In order to substract the countries in focus, we have used the metadata provided by Eurostat to filter out the data and variables of interest, using their respective country codes. The variables we are interested in are the following:**

-   **geo = Tells us which country and sub-region we are looking at**
-   **time_period = Observed years**
-   **obs_value = The value of the observation**
-   **Unit = Currency**

**By filtering out irrelevant data and variables and rearranging the dataset to provide a clearer view, results with the following datasets:**

```{r}
#| echo: FALSE
gdp_filtered |> 
  print(
    n = 5,
    width = 80
  )
pop |> 
  print(
    n = 5,
    width = 80
  )

```

### 2. GDP per capita calculation

In order to visualize the GDP per capita, we have merged the two datasets together and added a new variable that executes this formula in order to generate the GDP per capita for every country.

$y_i = \frac{\text{GDP}_i}{\text{population}_i} * 10^6$

It is worth noting that the GDP data from Eurostat is represented in million euros.
In order to better understand the graphs we have produced, we decided to multiply by one million, so that all numbers in the graph containing the GDP per capita is in full Euros.

GDP or Gross Domestic Product is a measure of value creation in a country.
This is described by Eurostat to be "a measure of economic activity, defined as the value of all goods and services produced minus the value of any goods or services used in their creation" @eurostat2023.
How Eurostat calculates the annual growth rate in GDP "comparisons of the dynamics of economic development both over time and between economies of different sizes" @eurostat2023.
To measure the growth rate of GDP over time "in volume, GDP in current prices is valued at the prices of the previous year, and the volume changes thus calculated are imposed on the level of a reference year; this is called a chain-linked series. Consequently, price movements will not inflate growth" @eurostat2023.

### 3. Descriptive analysis

### Austria

```{r}
#| echo: FALSE
#| label: fig-GDPAustria
#| cap-location: bottom
#| fig-cap: "GDP plot Austria"
merged_data |> 
  filter(str_detect(geo, "AT")) |> 
  ggplot(mapping = aes(
  x = year, 
  y = GDPpcn3, 
  colour = geo,
)) + 
  geom_line() +
  labs(title = "Austria",
       x = "Year",
       y = "GDP per capita")
```

```{r}
#| echo: FALSE
#| tbl-cap: Summary_Austria
# Generates descriptive statistics for variables in plot for AT

merged_data |> 
  filter(str_detect(geo, "AT")) |> 
  select(-1,-year) |> 
  st("GDPpcn3", add.median = TRUE)
```

Outliers: None

The sub-regions follow the same trends in GDP per per capita, with certain exceptions linked to a marked decrease in AT331 (Außerfern) in connection with 2008 (the financial crisis).
This may be due to the fact that this is an administrative district, and is often more exposed to a financial crisis.

All sub-regions have a decline in GDP per per capita from 2019 -- 2020 in connection with covid 19, where some sub-regions have a more marked decline than others.
This probably has a natural explanation in how the guidelines were followed through covid and how much the individual sub-region's gdp per capita depends on tourism.

In summary of the data set, Austria has a minimum value and a maximum value of 14,236 and 57,760 gdp per year, respectively.
capita, with a standard deviation of 9542.
This standard deviation measures how much spread or variance there is in the values in the data set.
Furthermore, the data set has an average of 32,066 GDP per capita, with a median of 30,679 GDP per capita.
When the median is lower than the mean, this means that the data set has more values closer to the minimum value in the data set.

### Belgium

```{r}
#| echo: FALSE
#| label: fig-GDPBelgium
#| cap-location: bottom
#| fig-cap: "GDP plot Belgium"
merged_data |> 
  filter(str_detect(geo, "BE")) |> 
  ggplot(mapping = aes(
  x = year, 
  y = GDPpcn3, 
  colour = geo
)) + 
  geom_line() +
    labs(title = "Belgium",
       x = "Year",
       y = "GDP per capita")
```

```{r}
#| echo: FALSE
# Generates descriptive statistics for variables in plot for BE
merged_data |> 
  filter(str_detect(geo, "BE")) |> 
  select(-1,-year) |> 
   st("GDPpcn3", add.median = TRUE)
```

The data set shows us that we have an outliers in the form of BE100 (Brussels) which has a significantly higher GDP per capita.
This has a natural connection with the fact that Brussels is the capital of Belgium, and has a higher traffic for trade than the other sub-regions.

Summarized by the data set, Belgium has a minimum value and a maximum value of 12756 and 71959 gdp per year respectively.
capita, with a standard deviation of 10143.
This standard deviation measures how much spread or variance there is in the values in the data set.
Furthermore, the data set has an average of 29,182 GDP per capita, with a median of 27,132 GDP per capita.
When the median is lower than the mean, this means that the data set has more values closer to the minimum value in the data set.

### Bulgaria

```{r}
#| echo: FALSE
#| label: fig-GDPBulgaria
#| cap-location: bottom
#| fig-cap: "GDP plot Bulgaria"
merged_data |> 
  filter(str_detect(geo, "BG")) |> 
  ggplot(mapping = aes(
  x = year, 
  y = GDPpcn3, 
  colour = geo
)) + 
  geom_line() +
    labs(title = "Bulgaria",
       x = "Year",
       y = "GDP per capita")
```

```{r}
#| echo: FALSE
# Generates descriptive statistics for variables in plot for BG
merged_data |> 
  filter(str_detect(geo, "BG")) |> 
  select(-1,-year) |> 
   st("GDPpcn3", add.median = TRUE)
```

The explanation behind the significantly higher GDP per capita.
capita in Sofia is that it is the capital of Bulgaria and is the administrative, cultural and economic center of the country.

Summarized by the data set, Bulgaria has a minimum value and a maximum value of 1087 and 19833 GDP per year respectively.
capita, with a standard deviation of 2283.
This standard deviation measures how much spread or variance there is in the values in the data set.
Furthermore, the dataset has an average of 3826 GDP per capita, with a median of 3378 GDP per capita.
When the median is lower than the mean, this means that the data set has more values closer to the minimum value in the data set.

Italy

The reason why we divide Italy into north and south is because it makes our ggplot more clear.

### North Italy

```{r}
#| echo: FALSE
#| label: fig-GDPNorthItaly
#| cap-location: bottom
#| fig-cap: "GDP plot North Italy"
merged_data |>
  filter(str_detect(geo, "ITC|ITH")) |> 
  ggplot(mapping = aes(
  x = year, 
  y = GDPpcn3, 
  colour = geo
)) + 
  geom_line() +
    labs(title = "North Italy",
       x = "Year",
       y = "GDP per capita")
```

```{r}
#| echo: FALSE
# Generates descriptive statistics for variables in plot for North Italy
merged_data |> 
  filter(str_detect(geo, "ITC|ITH")) |> 
  select(-1,-year) |> 
  st("GDPpcn3", add.median = TRUE)
```

Outliers: ITC4C (milano) og til dels ITH10 (boltzano)

In summary of the data set, Northern Italy has a minimum value and a maximum value of 19,555 and 55,890 gdp respectively.
capita, with a standard deviation of 5107.
This standard deviation measures how much spread or variance there is in the values in the data set.
Furthermore, the dataset has an average of 29,733 GDP per capita, with a median of 29,097 GDP per capita.
When the median is higher than the mean, this means that the data set has more values closer to the maximum value in the data set.

### South Italy

```{r}
#| echo: FALSE
#| label: fig-GDPSouthItaly
#| cap-location: bottom
#| fig-cap: "GDP plot South Italy"
merged_data |> 
  filter(str_detect(geo, "ITF|ITI|ITG")) |> 
  ggplot(mapping = aes(
  x = year, 
  y = GDPpcn3, 
  colour = geo
)) + 
  geom_line() +
    labs(title = "South Italy",
       x = "Year",
       y = "GDP per capita")
```

```{r}
#| echo: FALSE
# Generates descriptive statistics for variables in plot for Southern italy
merged_data |> 
  filter(str_detect(geo, "ITF|ITI|ITG")) |> 
  select(-1,-year) |> 
   st("GDPpcn3", add.median = TRUE)
```

Outliers: ITI14(Chieti), ITI43(Taranto).

Summarized by the data set, Southern Italy has a minimum value and a maximum value of 11713 and 42801 gdp per year respectively.
capita, with a standard deviation of 5302.
This standard deviation measures how much spread or variance there is in the values in the data set.
Furthermore, the data set has an average of 20995 GDP per capita, with a median of 19788 GDP per capita.
When the median is lower than the mean, this means that the data set has more values closer to the minimum value in the data set.

### Sweden

```{r}
#| echo: FALSE
#| label: fig-GDPSweden
#| cap-location: bottom
#| fig-cap: "GDP plot Sweden"
merged_data |> 
  filter(str_detect(geo, "SE")) |> 
  ggplot(mapping = aes(
  x = year, 
  y = GDPpcn3, 
  colour = geo
)) + 
  geom_line() +
    labs(title = "Sweden",
       x = "Year",
       y = "GDP per capita")
```

```{r}
#| echo: FALSE
# Generates descriptive statistics for variables in plot for SE
merged_data |> 
  filter(str_detect(geo, "SE")) |> 
  select(-1,-year) |> 
   st("GDPpcn3", add.median = TRUE)
```

Sweden: We have an extreme value in the form of a significantly higher GDP per capita in sub region SE110 which is Stockholm.
This can be explained by the fact that it is the capital and it is natural that value creation is centralized around Stockholm.

The data shows that there is a fall in GDP per capita throughout Sweden in 2008.
The natural explanation for this would be the financial crisis in 2008.

The data also shows a reduction in 2019 - 2020 in many sub-regions that can be linked to covid 19.
The reason why not all sub-regions had this drop may be that large parts of Sweden did not comply with the restrictions linked to the infection of the virus.

Summarized by the data set, Sweden has a minimum value and a maximum value of 23331 and 66250 GDP per year respectively.
capita, with a standard deviation of 7515.
This standard deviation measures how much spread or variance there is in the values in the data set.
Furthermore, the data set has an average of 35,757 GDP per capita, with a median of 39,550 GDP per capita.
When the median is higher than the mean, this means that the data set has more values closer to the maximum value in the data set.

### Croatia - became a member in 2012

```{r}
#| echo: FALSE
#| label: fig-GDPCroatia
#| cap-location: bottom
#| fig-cap: "GDP plot Croatia"
merged_data |> 
  filter(str_detect(geo, "HR")) |> 
  ggplot(mapping = aes(
  x = year, 
  y = GDPpcn3, 
  colour = geo
)) + 
  geom_line() +
    labs(title = "Croatia",
       x = "Year",
       y = "GDP per capita")
```

```{r}
#| echo: FALSE
# Generates descriptive statistics for variables in plot for HR
merged_data |> 
  filter(str_detect(geo, "HR")) |> 
  select(-1,-year) |> 
   st("GDPpcn3", add.median = TRUE)
```

From the data set we see that Croatia are missing populationdata in the subregions HR050, HR061- HR065 and HR021 - HR028.
We therefore only have data from the subregions HR031 - HR037 to take a closer look at GDP per capita.
From the data set, we see that all the subregions have a similar trend pattern, where the fall in GDP in 2019 - 2020 can be explained by Covid - 19.

There are three sub regions in the form of HR031, HR036 and HR037 which are Primorsko Goranska, Istrian and Dubrovnik-Neretva stand out with a higher GDP per Capita.
All these sub-regions are located along the coast, and this would likley attract tourism.

In summary of the data set, Croatia has a minimum value and a maximum value of 4144 and 15985 GDP per year respectively.
capita, with a standard deviation of 2692.
This standard deviation measures how much spread or variance there is in the values in the data set.
Furthermore, the data set has an average of 9644 GDP per capita, with a median of 9155 GDP per capita.
When the median is lower than the mean, this means that the data set has more values closer to the minimum value in the data set.

### Serbia (EU candidate country)

```{r}
#| echo: FALSE
#| label: fig-GDPSerbia
#| cap-location: bottom
#| fig-cap: "GDP plot Serbia"
merged_data |> 
  filter(str_detect(geo, "RS")) |> 
  ggplot(mapping = aes(
  x = year, 
  y = GDPpcn3, 
  colour = geo
)) + 
  geom_line() +
    labs(title = "Serbia",
       x = "Year",
       y = "GDP per capita")
```

```{r}
#| echo: FALSE
# Generates descriptive statistics for variables in plot for RS
merged_data |> 
  filter(str_detect(geo, "RS")) |> 
  select(-1,-year) |> 
   st("GDPpcn3", add.median = TRUE)
```

The reason why the dataset lacks GDP per capita in Serbia from 2000 - 2017 is explained by the fact that Serbia is an EU candidate and not part of the EU.
It is therefore partly unclear where we get data from 2017 - 2020, but can be explained by the fact that Serbia applied to join the EU in December 2009, and received the status of "EU candidate" in March 2012.
The reason why there is no data dating back to 2012 may have a connection with the fact that this is a war-torn country.

In the data set, there is an outliers RS221 (Bor region) which stands out significantly in the form of a higher GDP per capita, but also a significant increase in GDP per capita from 2018 - 2020 for approx 5,800 £ to 8,000 £ GDP per capita.
The rest of the sub-regions follow the same trends in GDP per capita, but differ, on the other hand, in that the sub-regions lie in the interval between approximately 2,500 £ to 3,600£ and 4,000 £ to 5,200 £.
This may indicate that the sub-regions are grouped in 2 different intervals in GDP per capita

Summarized by the data set, Serbia has a minimum value and a maximum value of 2534 and 8312 GDP per year respectively.
capita, with a standard deviation of 1081.
This standard deviation measures how much spread or variance there is in the values in the data set.
Furthermore, the data set has an average of 4209 GDP per capita, with a median of 4116 GDP per capita.
When the median is lower than the mean, this means that the data set has more values closer to the minimum value in the data set.

Bosnia and Herzegovia (EU candidate Countries)

The reason why Bosnia and Herzegovina lacks data from 2000 - 2020 in Eurostat is explained by the fact that they did not become an EU candidate until December 2022.

## Part B: Regional inequity

### 1. Literature review

Regional inequality shows variation in regional GDP per capita, and according to @lessmann2017, regional inequality occurs when one region experiences different assumptions than other regions.
Moreover, when the level of economic development is high, there is significant regional inequality [@lessmann2017].
According to @williamson1965, one crucial difference that leads to regional inequality is the access to natural resources.
Regions rich in natural resources grow faster than regions in the rest of the country, which results in inequality.
Furthermore, openness is another critical element of why regional inequality occurs.
A region with more significant access to the international trade market than other regions with limited access will gain more from international trade if international trade costs decrease [@lessmann2017].

Moreover, openness can also contribute to foreign investors investing in a more attractive region, e.g., access to natural resources.
In the end, this led to an imbalance in regional equality.
Additionally, mobility can provide regional inequality through differences in transport costs from one region to another [@lessmann2017].
The differences in transport costs are caused, e.g. by fuel consumption per kilometre.
 

Furthermore, another significant element creating regional inequality is bureaucracy, policy and stability in a country [@lessmann2017].
Civil war affects the country's balance of regional equality and creates different assumptions.
An example is regions in a country that experience increasing aid.
Receiving assistance from foreign aid organisations creates inequality.
Lastly, @lessmann2017 state that an area where ethnic groups dominate as a minority can result in regional inequity.

Based on the research conducted by @lessmann2017, considering regional inequities is essential since it can influence economic outcomes.
The research shows many examples of high- and low-income countries experiencing unbalanced regional development that results in income inequality [@lessmann2017].

**The Gini coefficient is a measurement for inequality, used in regions to measure the inequalities in sub regions of a country @lessmann2017 . We have used the weighted Gini coefficient which takes a regions GDP per capita with regards to population, The reasoning behind this is to get the true Gini coefficient, and not omit the population variable, as it is a important variable for explaining a regions inequality. By looking at the gini coefficient at a NUTS2 level, we are expecting to see the socio-economic differences, and to understand the reasoning behind the inequity based on factors such as resource allocation. By looking at a 20 year span, we are also expecting to be able to predict and forecast future trends.**

### 2. Gini coefficient calculation

To calculate the population-weighted Gini coefficient for GDP for each European NUTS2 level region within Germany, Finland and Romania, we used the data on the GDP and population for the different regions and associated countries.
The Gini coefficient measures income or wealth inequality within a population [@imfnd].
In this case, we want to calculate the Gini coefficient for GDP, which is a measure of economic inequality.
We calculated the Gini coefficient using the following formula:

**In order to calculate the Gini coefficient for NUTS2 regions using NUTS3 data, we first have to group population and GDP per capita of the level 3 data to level 2. This has been done by subtracting the common denominator, country codes. Grouping makes it possible to utilize the formula by weighing the level 2 regions GDP per capita by population, as seen below.**

$GINW_j=\frac{1}{2 \bar{y_j}} \sum_{i}^{n_j}\sum_{l}^{n_j}\frac{p_i}{P_j} \frac{p_l}{P_j} |y_i-y_l|$

We want to calculate the weighted average of the Gini coefficients based on the population of each region or country.
We do this by calculating a new column called gini_n2 using mutate, and applying the gini.wtd function, which compute a weighted Gini coefficient based on GDP per capita.

The population-weighted Gini coefficient provides a measure of economic inequality across all our regions and associated countries, taking into account their respective populations [@imfnd].
A Gini coefficient close to 0 indicates a more equal distribution of income or wealth among the population.
In societies with low Gini coefficients, there is relatively less income or wealth inequality, and resources are more evenly distributed among individuals or households.
These societies tend to have a larger middle class and fewer people living in poverty or extreme wealth [@imfnd]

A Gini coefficient close to 1 signifies a high level of income or wealth inequality.
In societies with high Gini coefficients, a significant portion of the income or wealth is concentrated among a small percentage of the population, leading to pronounced disparities.
These societies may have a large gap between the rich and the poor, with some individuals or households having substantially more resources than others [@imfnd].

The zero values occur as a result of some regions are actually defined as a region, but in reality they are a foreign embassy, army base or offshore energy production with no permanent residence.
This means they do not have any GDP per capita [@eurostat2021].
Moreover, we assume that the zero values can also be a result of missing data report from different regions in Germany and Finland.

```{r}
#| echo: false
#| label: Gini coefficient
# Grouping NUTS3 to NUTS2
# Adding the gini coefficient to the gpd pr capita variable and weighing by population (grouped by nuts2)
merged_data <- merged_data |> 
  filter(!is.na(Population),
         Population != 0,
         GDPpcn3 != 0, 
         GDPpcn3 != "NA"
  ) |> 
group_by(nuts2, year) |> 
  mutate(gini_n2 = gini.wtd(GDPpcn3, Population),
         GDPpcn2 = mean(GDPpcn3), 
         popn2 = sum(Population),
         GDPn2 = sum(GDP),
         numberofregions = n_distinct(geo)
         ) |> 
  slice(1) |> 
  ungroup() |> 
  select(nuts0, nuts2, geo, year, GDP, Population, GDPpcn3, gini_n2, numberofregions, GDPn2, GDPpcn2, popn2) 
  # number of regions is wrong, want to show number of nuts3 regions in a nuts2 region as a vector
```

### Data Presentation

```{r}
#| fig.height = 15, fig.width = 12
# Added fig arguments in chunk in order to control the size of the facet wraps and colourgraded the gini coefficient intervals
merged_data |> 
  ggplot(mapping = aes(
    year, gini_n2, colour = gini_n2, group = nuts2
  )) +
  geom_line(alpha = 0.5) +
  geom_point(alpha = 1, size = 1, stroke = 1,) +
  scale_colour_gradient(low = "skyblue", high = "red") +
  facet_wrap(~ nuts0, ncol = 2, scales = "free", shrink = FALSE) +
               labs(title = "Visualization of the gini coefficient intervals in each country", size = 20) +
  theme(plot.title = element_text(size = 20)) 

   
```

## Outliers

### Bulgaria (South west: BG41)

The main outlier in Bulgaria the line that from 2000, was already over 15%.
This is the region BG41, also known as south west.
The reason behind this outlying difference is because the capital of Bulgaira, Sofia, is a sub-region of BG41.
In Sofia, the GDP per capita in 2020 was nearly triple as much as the second highest sub-regions GDP per capita.

### Italy (Lombardia: ITC4)

Lombardia has the biggest inequality in the whole of Italy, with the highest Gini coefficient ( Gini \>0.15 in 2020).
ITC4 contains big cities such as Milano, which has two of the biggest football teams in the world, and is known for being the capital of fashion.
This attracts tourism and a spike in the regions GDP.

### Belgium (East Flanders: BE23)

Explained by the span of GDP per capita in sub-regions where the highest GDP per capita being 49 964 and the lowest 17 401, while the average spans between \[17 000:21 000\].

### Not included countries

We have not included the following countries based on a lack of observations on level 3 data.
Croatia has 140 observations , Serbia has 68 and Bosnia and Herzegovina became a EU candidate in 2022 and because of this lacks any data.

# Assignment 2 Part A: Growth and Inequity

## **1. Model Estimation**

In this part we want to estimate a simple linear regression model for the year 2010, with regional development, measured in GDP per capita, as the independent variable and regional inequality, measured in Gini, as the dependent variable.
This is because we want to see the impact a change in the regional development will have on inequity in a given country.

Lessmann and Seidel discuss that the national development level can be an outcome of regional inequalities.
Our aim is to showcase this with regional development (GDP per capita​) as the independent variable and regional inequality (gini_n2) as the dependent variable.

Our aim is to explain the regional inequalities with regional development as the explanatory variable.
This brings forward the following expression:

$$
Gini = ß_0 + ß_1GDPpcn2
$$

*"Existing studies have shown a serious bias towards middle -- and high -income countries entire population"* [@lessmann2017].
We therefore use the level of economic development measured as log by the GDP pr capita measured in euros in million\`s.
The reason why we use GDP per capita on a regional level is because the of GDP pr capita and GDP has a different meaning.
GDP measure a country as a hole, where the GDP per capita is measuring the productivity of the population.

We will reduce bias by looking at country's entire populations through the GDP per capita of Italy and Germany.
The reason we choose the selected countries is because they are the largest and have the most observations, which reduces potential bias.

*Theory:*

An increase in GDP per capita will lead to a decrease in the Gini coefficient (regional inequity).
The basis for this theory is that an increase of ten thousand euros (one percent of one million) in GDP per capita will have a greater effect on the regions that stand out.
There comes a point where an increase in GDP per capita will have a greater impact on those with a small GDP per capita, versus those with a larger GDP per capita.
The reason for this is because the effect of the increase in GDP per capita hits those with larger GDP per capita different than those with a smaller GDP per capita.

```{r}
#| echo: false
#| cap-location: bottom
#| tbl-cap: "Linear regression model year 2010 for Germany and Italy"
# Estimating linear regression models for Germany and Italy with Gini and GDP per capita.
lmDE <- lm(gini_n2 ~ log(GDPpcn2), subset(merged_data, year == 2010 & nuts0 == "DE" & gini_n2 > 0))
lmIT <- lm(gini_n2 ~ log(GDPpcn2), subset(merged_data, year == 2010 & nuts0 == "IT" & gini_n2 > 0))

lmSE <- lm(gini_n2 ~ log(GDPpcn2), subset(merged_data, year == 2010 & nuts0 == "SE" & gini_n2 > 0))

huxreg(DE = lmDE, IT = lmIT, SE = lmSE, statistics = c("r.squared","adj.r.squared", "statistic", "p.value"))
```

In the table above we see the coefficients, standard errors, and significance levels (indicated by asterisks) for a simple linear regression model for the year 2010.
The model has GDP per capita as the independent variable and regional Gini as the dependent variable for both Germany (DE) and Italy (IT).

For Germany (DE), the intercept coefficient is -2.129\*\*, which indicates a high level of statistical significance at the 1% level.
This means that when GDP per capita is zero, the estimated Gini coefficient for Germany is -2.129.
The standard error of the intercept is 0.755, indicating the precision of the estimate.

For Italy (IT), the intercept coefficient is -0.478 and is not significant.
This means that when GDP per capita is zero, the estimated Gini coefficient for Italy is 0.478.
The standard error of the intercept is 0.433.

For Germany (DE), the coefficient for log(GDPpcn2) is 0.222\*\*.
This implies a high level of statistical significance at the 1% level.
In other words, there is strong evidence of a positive linear relationship between the GDP per capita and the Gini coefficient in Germany in 2010.
The standard error associated with the coefficient is 0.073, which indicates the precision of this relationship.

For Italy (IT), the coefficient for log(GDPpcn2) is 0.052.
The absence of asterisks suggests that this coefficient is not statistically significant at commonly used significance levels.
This implies that there is no strong statistical evidence of a linear relationship between the GDP per capita and the Gini coefficient in Italy in 2010.
The standard error of the coefficient is 0.043, providing a measure of the precision of this relationship.

## **Model Diagnostics**

R-squared (r.squared) is a measure of how well the independent variable(s) explain the variation in the dependent variable.
For Germany, the R-squared is 0.229, indicating that approximately 22.9% of the variation in the Gini coefficient can be explained by variations in log(GDPpcn2).
For Italy, the R-squared is 0.090, suggesting that about 9.0% of the variation in the Gini coefficient can be explained by variations in log(GDPpcn2).

Adjusted R-squared (adj.r.squared) is a modified version of R-squared that accounts for the number of independent variables.
It penalizes the inclusion of unnecessary variables.
For both Germany and Italy, the adjusted R-squared is lower than the R-squared, indicating that some variables may not be contributing significantly to the model.

The statistic value (statistic) and p-value (p.value) are typically used to test the overall significance of the regression model.
For Germany, the t-statistic is 9.183, and the associated p-value is 0.005, indicating that the model is statistically significant at the 0.05 significance level.
For Italy, the t-statistic is 1.485, and the associated p-value is 0.242, suggesting that the model is not statistically significant at the 0.05 significance level.

### **Classical assumptions OLS**

There are underlying assumptions in statistical analysis like ordinary least squares regression (OLS).
OLS yields the best estimates when these conventional presumptions hold true.
OLS regression is based on six traditional assumptions.
Our models are unbiased if the first four conditions are met.
Below is a list of all six presumptions:

1.  Linearity: There must be a linear relationship between the dependent variable (regional GINI) and independent variable (GDP per capita).
    We can read from the two scatterplots below, @fig-scatterplot-RL-DE and @fig-scatterplot-RL-IT, that the relationship for both Germany and Italy seems to be linear, with only some few outliers.

2.  Sample variation: We can also see from @fig-scatterplot-RL-DE and @fig-scatterplot-RL-IT that there is variation in the independent variable (GDP per capita).

3.  Random sampling: We have chosen randomly a representative sample of the population of interest.
    Also, the data is downloaded from Eurostat, which is a trustworthy source for random sampling.
    Additionally, we have also removed NA values.

4.  Exogeneity: In our case the explanatory variable (GDP per capita) should not be influenced by other variables in the model, meaning it is exogenous.

5.  Homoskedasticity: In our case the error term does not seem to have the same variance for each value of the independent variable, as seen in the two scatter plots in the appendix.

6.  Normality: Because our Error term is not equal to zero, the population error term is not normally distributed in our datasets.

## Visualization

```{r}
#| echo: FALSE
#| label: fig-scatterplot-RL-DE
#| cap-location: bottom
#| fig-cap: "Scatter Plot with Regression Line (Year 2010, DE)"
# Visualizing the linear regression of the gini coefficient by GDP per capita for Germany
merged_data_filtered <- merged_data %>%
  filter(str_detect(geo, "DE") & year == 2010 & gini_n2 > 0)

ggplot(merged_data_filtered, aes(x = log(GDPpcn2), y = gini_n2)) +
  geom_point() +
  geom_smooth(method = "lm", formula = y ~ x, se = FALSE) +  
  labs(
    x = "GDP per capita nuts2",
    y = "Gini Index (n2)"
  )

```

```{r}
#| echo: FALSE
#| label: fig-scatterplot-RL-IT
#| cap-location: bottom
#| fig-cap: "Scatter Plot with Regression Line (Year 2010, IT)"
# Visualizing the linear regression of the gini coefficient by GDP per capita for Italy
merged_data_filtered <- merged_data %>%
  filter(str_detect(geo, "IT") & year == 2010 & gini_n2 > 0)

ggplot(merged_data_filtered, aes(x = log(GDPpcn2), y = gini_n2)) +
  geom_point() +
  geom_smooth(method = "lm", formula = y ~ x, se = FALSE) +  # Specify the formula
  labs(
    x = "GDP per capita nuts2",
    y = "Gini Index (n2)"
  )
```

## Part B: Exploring Other Determinants of Inequity

### **1. Data Acquisition**

To further understand the inequality on a regional level it is necessary to look for other variables that can contribute to explaining the Gini coefficient.
Variables that may help explain this is the educational level of the population, the area of the region as well as the amount of highway infrastructure that a region has.
The education data gathered is measured in the percentage of the population that has completed a higher education level (ED5-8) from the age of 20 to 65.
The area data is measured in squared kilometers and the road data is the total amount of highway infrastructure that a region has.

If a region has a big difference in the level of education among subregions, we believe this will increase the regional inequality.
Human capital is one of the most important determinants of differences in reginal development within countries @lessmann_and_seidel2017.
*"Human capital creates positive externalities, which can also spill over reginal boundaries"* @lessmann_and_seidel2017.
Unfortunately, this data is not available for Germany and Italy.
We therefore fall back upon the average quality of human capital within Germany and Italy, as measured by the education level ED5-8 to look if a percentage of higher education increase inequality in a region.

We believe that if a region has a big difference in the level of education among subregions, this will increase the regional inequality based on the assumption that a subregion with higher educated citizens will typically earn more than subregions with lesser educated citizens, thus increasing the difference in GDP per capita on the regional level.
Another assumption that can explain the increased expectancy, is that higher educated citizens tend to have a higher probability of centralizing towards city centers, contrary to less educated citizens.

The centralization assumption is also true for the area of the regions.
If a region is large, the probability for centralization could be bigger, based on factors such as job markets, mobility and distance between cities or areas.
This is the basis of why we chose to add the highway infrastructure variable, as a higher level of infrastructure might decrease the likelihood for centralization as mobility increases.
  

### 2. **Multiple Linear Regression Model**

```{r}
#| echo: FALSE
# Adding the new variables to the main dataset
merged_data <- left_join(merged_data, aream2, by = c("nuts2", "year"))

merged_data <- left_join(merged_data, educ, by = c("nuts2", "year"))

merged_data <- left_join(merged_data, roads, by = c("nuts2", "year"))
```

```{r}
#| echo: FALSE
#| label: Dataset for 2010 variables
# Creating a new dataset that only contains Germany and Italy for the year 2010.
merged2010 <- merged_data |> 
  filter(year == 2010) |> 
  select(nuts2, year, everything()) |> 
  select(nuts2, year, GDPpcn2, gini_n2, education, area, Roadkm) |> 
  filter(str_detect(nuts2, "IT|DE"), nchar(nuts2) == 4) |> 
  filter(
    Roadkm != "NA",
    Roadkm != 0
  ) |> 
  mutate(
    nuts0 = substr(nuts2, 1,2)
  ) |> 
    mutate(
    roadratio = Roadkm/area
  ) |> 
  select(
    nuts0, nuts2, everything()
  )
```

```{r}
#| echo: FALSE
#| tbl-cap: Multiple regression models

# In lm1 and lm2 we look at how the GDP per capita of each nuts 2 region as well as education may explain the gini coefficient. We have used. a log transformation on the GDP because both gini and education is measured in percentages, and without doing so the GDP data is significantly skewed

lm1 <- lm(gini_n2 ~ log(GDPpcn2) + education, subset(merged2010, year == 2010 & nuts0 == "DE" & gini_n2 > 0))
lm2 <- lm(gini_n2 ~ log(GDPpcn2) + education, subset(merged2010, year == 2010 & nuts0 == "IT" & gini_n2 > 0))

# lmarea looks at the above, but adds the area variable. This is also log transformed as we are interested in the changes in percentage

lmarea <- lm(gini_n2 ~ log(GDPpcn2) + education + log(area), subset(merged2010, year == 2010 & nuts0 == "DE" & gini_n2 > 0))

lmarea2 <- lm(gini_n2 ~ log(GDPpcn2) + education + log(area), subset(merged2010, year == 2010 & nuts0 == "IT" & gini_n2 > 0))

# lm3 and lm4 also includes roads (amount of highway in kilometres in a region). These models takes all explanatory variables in to account.

lm3 <- lm(gini_n2 ~ log(GDPpcn2) + education + log(area) + log(Roadkm), subset(merged2010, year == 2010 & nuts0 == "DE" & gini_n2 > 0))

lm4 <- lm(gini_n2 ~ log(GDPpcn2) + education + log(area) + log(Roadkm), subset(merged2010, year == 2010 & nuts0 == "IT" & gini_n2 > 0))

huxreg("Model 1 DE" = lm1, "Model 1 IT" = lm2, "Model 2 DE" = lmarea, "Model 2 IT" = lmarea2, "Model 3 DE" = lm3, "Model 3 IT" = lm4, statistics = c("r.squared","adj.r.squared", "statistic", "p.value"))
```

The provided multiple regression models aim to explain regional inequality, with three different models.

-   Model 1; Explains how regional development (GDP per capita) as the independent variable and regional inequality (gini_n2) as the dependent variable is affected by education when it comes to inequality for the country's DE (Germany), and IT (Italy).
-   Model 2; Explains how regional development (GDP per capita) as the independent variable and regional inequality (gini_n2) as the dependent variable is affected by education and area when it comes to inequality for the country's DE (Germany), and IT (Italy).
-   Model 3; Explains how regional development (GDP per capita) as the independent variable and regional inequality (gini_n2) as the dependent variable is affected by education + area + Road(km) when it comes to inequality for the country's DE (Germany), and IT (Italy).

### 3. **Model Interpretation**

In Model 1, the R-squared values are 0.222 for Germany and 0.122 for Italy.
In Model 2, they increase to 0.309 for Germany and 0.338 for Italy.
In Model 3, they remain relatively consistent at 0.313 for Germany and 0.340 for Italy.

The adjusted R-squared values follow a similar pattern, indicating that Model 2 has the highest explanatory power for both Germany and Italy.
However, the increase in R-squared between Model 1 and Model 2 suggests that Model 2 provides a better fit compared to Model 1.

The coefficients associated with each independent variable (log(GDPpcn2), education, log(area), and log(Roadkm)) indicate the direction and strength of their influence on regional inequality.
For log(GDPpcn2), positive coefficients indicate that an increase in GDP per capita is associated with higher regional inequality.
In Model 2 and Model 3, log(GDPpcn2) is statistically significant at the 0.01 significance level for both Germany and Italy.
For education, negative coefficients suggest that higher education levels are associated with lower regional inequality.
However, in all models, education is not statistically significant.
For log(area), positive coefficients imply that larger regions tend to have higher regional inequality.
In Model 2 and Model 3, log(area) is statistically significant at the 0.05 significance level for both Germany and Italy.
For log(Roadkm), the coefficients are generally small, and in Model 2 and Model 3, they are not statistically significant.

The F-statistic value and p-value indicate that Model 2 is statistically significant at the 0.01 significance level for both Germany and Italy, while Model 1 is statistically significant for Germany but not for Italy.
Model 3 is statistically significant at the 0.05 significance level for Germany but not for Italy.

In summary, Model 2 appears to have the best overall fit, as indicated by the highest R-squared and adjusted R-squared values for both Germany and Italy.
The primary contributor to explaining variations in regional inequality appears to be log(GDPpcn2), as it is consistently statistically significant at the 0.01 significance level in Model 2 and Model 3.
The impact of other independent variables, such as education, log(area), and log(Roadkm, is less clear, as they are generally not statistically significant in the models. The specific implications of these findings would depend on the context of your analysis and the objectives of your research. It's important to consider the practical significance of these results and conduct further analysis if needed.

# Assignment 3

## Part A: Testing development effects across subsets

### 1. Subset analysis

```{r}
#| echo: FALSE
#| tbl-cap: The effect of regional development on inequality
# Fit the three models
partaDE <- lm(gini_n2 ~ GDPpcn2, data = subset(merged_data, nuts0 == "DE" & gini_n2 > 0))
partaIT <- lm(gini_n2 ~ GDPpcn2, data = subset(merged_data, nuts0 == "IT" & gini_n2 > 0))
partaSE <- lm(gini_n2 ~ GDPpcn2, data = subset(merged_data, nuts0 == "SE" & gini_n2 > 0))

huxreg(DE = partaDE, IT = partaIT, SE = partaSE, statistics = c("r.squared","adj.r.squared", "statistic", "p.value"), 
       stars = c("*" = 0.1, "**" = 0.05, "***" = 0.01),
       note = "Note): {stars} T statistics in brackets.")
```

### 2. Subset analysis discussion

In examining the impact of regional development on inequality across Germany (DE), Italy (IT), and Sweden (SE), we see notable differences.
In Germany (DE) the intercept is 0.039 (p \< 0.01), indicating a positive effect on inequality.
The GDPpcn2 coefficient is 0.000 (p \< 0.01), signifying a statistically significant yet minimal impact on inequality.
In Italy (IT), the intercept is -0.011 meaning it is not statistically significant.
The GDPpcn2 coefficient, at 0.000 (p \< 0.01), highlights a negligible association with inequality.
Sweden (SE), the intercept of -0.009 (p \< 0.01) suggests a negative impact.
The GDPpcn2 coefficient, at 0.000 (p \< 0.01), mirrors Germany's minimal effect on inequality.

Germany exhibits a positive baseline effect, while Italy and Sweden lean towards negative baselines.
Development effects, though statistically significant, are uniformly marginal across subsets.
The reason for this might be that Germany, Italy, and Sweden may have different economic structures.
For instance, Germany might have a more export-oriented or manufacturing-heavy economy compared to Italy and Sweden.
The nature of economic activities can impact the relationship between regional development and inequality.
Also, the level of regional disparities within each country could be a factor.
Germany may have regions that benefit more from development, leading to a positive baseline effect.
In contrast, Italy and Sweden might have regions experiencing less impact or even negative effects.

## Part B: Exploring alternative functional forms

### 1. Functional form exploration

*We have selected the alternative functional forms logarithmic and quadratic select because they may provide a better fit. Why?*

Logarithmic Model: This form is appropriate when the relationship between y and x is expected to nonlinear and the effect of x on y diminishes or increases at a decreasing rate.
It's commonly used when there's diminishing marginal returns.

$$
Inequality_i = ß_0 + ß_1 log(Development_i) + ε_i
$$

```{r}
#| echo: FALSE
#| tbl-cap: The effect of log regional development on inequality
lmlogDE <- lm(gini_n2 ~ log(GDPpcn2), subset(merged_data, nuts0 == "DE" & gini_n2 > 0))

lmlogIT <- lm(gini_n2 ~ log(GDPpcn2), subset(merged_data, nuts0 == "IT" & gini_n2 > 0))

lmlogSE <- lm(gini_n2 ~ log(GDPpcn2), subset(merged_data, nuts0 == "SE" & gini_n2 > 0))

huxreg("Model 1 DE" = lmlogDE, "Model 1 IT" = lmlogIT, "Model 1 SE" = lmlogSE, statistics = c("r.squared","adj.r.squared", "statistic", "p.value"), 
       stars = c("*" = 0.1, "**" = 0.05, "***" = 0.01),
       note = "Note): {stars} T statistics in brackets.")
```

Quadratic model: A quadratic relationship implies a non linear U-shaped or inverted u-shaped relationship between development and inequality.

$$
Inequality_i = ß_0 + ß_1logDevelopment_i + ß_2(logDevelopment)^2
$$

We believe that the regional development in a quadratic model will have a concave shape as we believe that an increase in GDP per capita will have a increased effect on inequality but a decreased effect as the number increases.

```{r}
#| echo: false
# Mutated a new variable logGDPpcn2quad = logGDPpcn2^2
merged_data <- merged_data |> 
  mutate(
    logGDPpcn2 = log(GDPpcn2),
    logGDPpcn2quad = logGDPpcn2^2
  )
```

```{r}
#| echo: FALSE
#| tbl-cap: The effect of log squared regional development on inequality
lmquadDE <- lm(gini_n2 ~ logGDPpcn2 + logGDPpcn2quad, subset(merged_data, nuts0 == "DE" & gini_n2 > 0))

lmquadIT <- lm(gini_n2 ~ logGDPpcn2 + logGDPpcn2quad, subset(merged_data, nuts0 == "IT" & gini_n2 > 0))

lmquadSE <- lm(gini_n2 ~ logGDPpcn2 + logGDPpcn2quad, subset(merged_data, nuts0 == "SE" & gini_n2 > 0))

huxreg("Model 1 DE" = lmquadDE, "Model 1 IT" = lmquadIT, "Model 1 SE" = lmquadSE, statistics = c("r.squared","adj.r.squared", "statistic", "p.value"), 
       stars = c("*" = 0.1, "**" = 0.05, "***" = 0.01),
       note = "Note): {stars} T statistics in brackets.")
```

...

### 2. Estimation and visualization

-   Estimate and visualize the models, clearly annotating and interpreting the results.

```{r}
#| echo: false
#| label: fig-logGDPpcn2DE
#| cap-location: bottom
#| fig-cap: "Scatter Plot with Regression Line showing the relationship between the gini coefficient and GDP per capita"
# 
merged_data |> 
  filter(numberofregions > 1, nuts0 == "DE") |> 
  ggplot(
    aes(
      x = logGDPpcn2,
      y = gini_n2
    )
  ) + geom_point() + geom_smooth(method = "lm", formula = y ~ poly(x,2), se = F, span = 1) 
```

```{r}
#| echo: false
#| label: fig-logGDPpcn2IT
#| cap-location: bottom
#| fig-cap: "Scatter Plot with Regression Line showing the relationship between the gini coefficient and GDP per capita"
merged_data |> 
  filter(numberofregions > 1, nuts0 == "IT") |> 
  ggplot(
    aes(
      x = logGDPpcn2,
      y = gini_n2
    )
  ) + geom_point() + geom_smooth(method = "lm", formula = y ~ poly(x,2), se = F, span = 1) 
```

```{r}
#| echo: false
#| label: fig-logGDPpcn2SE
#| cap-location: bottom
#| fig-cap: "Scatter Plot with Regression Line showing the relationship between the gini coefficient and GDP per capita"
#| 
merged_data |> 
  filter(numberofregions > 1, nuts0 == "SE") |> 
  ggplot(
    aes(
      x = logGDPpcn2,
      y = gini_n2
    )
  ) + geom_point() + geom_smooth(method = "lm", formula = y ~ poly(x,2), se = F, span = 1)
```

### 3. Results interpretation

In comparing the original linear model estimating the effect of regional development on inequality within Germany, Italy, and Sweden, with two alternative functional forms (logarithmic and quadratic), we see notable differences.

As discussed earlier, the original linear model **seen in table X,** indicates a significant but marginal impact of GDP per capita (GDPpcn2) on inequality across all three countries.
The R-squared values of 12,7%, 13,7% and 12,9% for Germany, Italy and Sweden respectively, suggest a reasonable fit to the data.

In the logarithmic alternative model, **seen in table X**, the relationship between regional development and inequality is captured in a log-linear fashion.
The coefficients for Germany, Italy, and Sweden reveal significant associations.
Notably, the logarithmic model improves the fit, as indicated by the increased adjusted R-squared values, particularly in Germany and Italy.

The quadratic alternative model, **seen in table X,** introduces a quadratic term to accommodate potential curvature in the relationship.
Coefficients for all countries show statistical significance, and the model significantly improves the fit, as evidenced by higher adjusted R-squared values across all subsets.

Both alternative models, the logarithmic and quadratic, offer improvements over the original linear model.
The logarithmic model provides a nuanced, potentially nonlinear perspective on the relationship between regional development and inequality, particularly enhancing fit in Germany and Italy.
On the other hand, the quadratic model introduces a curvature component, suggesting a more complex interplay between regional development and inequality.
These alternative models present enhanced explanatory power, capturing potential nonlinearities in the intricate relationship between regional development and inequality across Germany, Italy, and Sweden.

## Part C: Heteroskedasticity testing and causality discussion

```{r}
lmDE2 <- lm(gini_n2 ~ log(GDPpcn2), subset(merged_data, nuts0 == "DE" & gini_n2 > 0))
lmIT2 <- lm(gini_n2 ~ log(GDPpcn2), subset(merged_data, nuts0 == "IT" & gini_n2 > 0))

lmSE2 <- lm(gini_n2 ~ log(GDPpcn2), subset(merged_data, nuts0 == "SE" & gini_n2 > 0))
```

```{r}
lmlogDE <- lm(log(gini_n2)^2 ~ (log(GDPpcn2))^2, subset(merged_data, nuts0 == "DE" & gini_n2 > 0))

lmlogIT <- lm(log(gini_n2)^2 ~ (log(GDPpcn2))^2, subset(merged_data, nuts0 == "IT" & gini_n2 > 0))

lmlogSE <- lm(log(gini_n2)^2 ~ (log(GDPpcn2))^2, subset(merged_data, nuts0 == "SE" & gini_n2 > 0))

bptest(lmlogDE)
bptest(lmlogIT)
bptest(lmlogSE)
plot(lmlogDE)
plot(lmquadDE)
```

```{r}
bptest(lmDE2)$p.value
bptest(lmIT2)$p.value
bptest(lmSE2)$p.value
#Quadratic models

bptest(lmquadDE)$p.value
bptest(lmquadIT)$p.value
bptest(lmquadSE)$p.value
```

### 1. Heteroskedasticity testing

-   Test for heteroskedasticity in the alternative and original models. Interpret and discuss the results and implications.

### 2. Causality discussion

-   Reflect on the causal interpretation of your models and suggest strategies to address any issues identified.

## Part D: Panel estimates

Sho,1)uld we divide our data into three subsets; one with all countries, one with tourists countries and one with all except tourist countries?

```{r}
# filtering merged data 
pmerged <- merged_data |> 
  filter(!is.na(Population),
         Population != 0,
         GDPpcn3 != 0, 
         GDPpcn3 != "NA"
  ) |> 
group_by(nuts2, year) |> 
  slice(1) |> 
  ungroup() |> 
  select(nuts0, nuts2, geo, year, gini_n2, GDPpcn2, logGDPpcn2, numberofregions) |> 
  filter(nuts0 == c("DE", "IT", "SE"))
```

```{r}
plm1 <- plm(gini_n2 ~ GDPpcn2 + log(GDPpcn2), data = pmerged, index = c("nuts0"), model = "within",effect = "twoway") %>%
  coeftest(vcov. = vcovHC, type = "HC1", save = TRUE)


plm2 <- plm(gini_n2 ~ GDPpcn2 + log(GDPpcn2), data = pmerged, index = c("year"), model = "within",effect = "twoway") %>%
  coeftest(vcov. = vcovHC, type = "HC1", save = TRUE)


plm3 <- plm(gini_n2 ~ GDPpcn2 + log(GDPpcn2), data = pmerged, index = c("nuts2"), model = "within",effect = "twoway") %>%
  coeftest(vcov. = vcovHC, type = "HC1", save = TRUE)


plm4 <- plm(gini_n2 ~ GDPpcn2 + log(GDPpcn2), data = pmerged, index = c( "year","nuts2"), model = "within",effect = "twoway") %>%
  coeftest(vcov. = vcovHC, type = "HC1", save = TRUE)
huxreg(plm1, plm2, plm3, plm4, statistics = NULL)
```

GDPpcn2:

Models 2 and 3 has significant effect, indicating the influence of time and regional fixed effects on the relationship.
Model 1 has a significant negative effect suggests increased regional development reduces regional inequality (p \< 0.001).
Model 4 has a significant positive effect suggests that, considering both country and time fixed effects, increased regional development increases regional inequality (p \< 0.001).

log(GDPpcn2):

Model 1 has a significant positive effect indicates a positive association between the logarithm of GDP per capita and regional inequality (p \< 0.001).
Model 2 has a significant negative effect suggests a negative association when considering only time fixed effects (p \< 0.05).
Model 3 has a significant negative effect suggests a negative association when considering only regional fixed effects (p \< 0.01).
Model 4 has a significant negative effect indicates a negative association when considering both country and time fixed effects (p \< 0.001).

Comparison of Fixed Effects Models:

Model 1 contains Country Fixed Effects.
There are a positive GDPpcn2 coefficient suggests increased regional development reduces regional inequality.
There are a negative log(GDPpcn2) coefficient suggests an increase in GDP per capita positively correlates with regional inequality.

Models 2 and 3 contains Time and Regional Fixed Effects.
There are no significant effect of GDPpcn2, where there are a negative log(GDPpcn2) coefficients suggest a negative association with regional inequality.

Model 4 contains both Country and Time Fixed Effects.
There are a Positive GDPpcn2 coefficient suggests increased regional development increases regional inequality where there are a negative log(GDPpcn2) coefficient suggests a negative association with regional inequality.

### 1. Panel estimation task

```{r}
dummyvar <- lm(gini_n2 ~ GDPpcn2 + log(GDPpcn2) + factor(year) + factor(nuts0), data = pmerged)
summary(dummyvar)

```

-   Using the entire dataset, estimate the effect of regional development on regional inequality through panel estimation techniques.

-   Present estimates considering different fixed effects (country, year, and NUTS 2 level), both separately and jointly.

### 2. Panel estimation analysis

-   Interpret the panel estimation results, emphasizing the implications of the fixed effects included.

-   Compare and contrast the panel estimates with the cross-sectional estimates obtained earlier, discussing the advantages and limitations of each approach.

By using panel data estimates, we can remove constants that might effect our estimates, by using time data as these effects will become obsolete as they do not change over time.
This gives us a better estimate on our variables.
This means that specific time constant factors and fixed effects are accounted for.

Nuts2 fixed effects = dummy for constant for observations belonging to the nuts2 region

panel estimate for fixed effects

Add number of regions to panel estimates

Interaction effect: gdp \* number of regions

Year FE and country FE (FE = fixed effect)

one estimate for each: year FE, country FE and nuts2 FE, and one for all

### 3. Panel estimation discussion

-   Critically evaluate the panel estimation findings, considering potential biases, inconsistencies, or limitations in the methodology.

## References

```{r}

```

# Appendix

## Residuals:

### Residuals vs. Fitted (Germany)

```{r}
#| echo: FALSE
residuals_DE <- resid(lmDE)

plot(lmDE$fitted.values, residuals_DE, xlab = "Fitted Values", ylab = "Residuals", main = "Residuals vs. Fitted (Germany)")
```

### Residuals vs. Fitted (Italy)

```{r}
#| echo: FALSE
residuals_IT <- resid(lmIT)

plot(lmIT$fitted.values, residuals_IT, xlab = "Fitted Values", ylab = "Residuals", main = "Residuals vs. Fitted (Italy)")
```
