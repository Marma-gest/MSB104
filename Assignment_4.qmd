---
title: "Assignment 4"
format: html
editor: visual
---

```{r}
#| label: setup
#| output: false
#| message: false
#| echo: false
library(eurostat)
library(dineq)
library(readr)
library(tidyverse)
library(stringr)
library(huxtable)
library(vtable)
library(ggplotify)
library(grid)
library(dplyr)
library(gridExtra)
library(ggplot2)
library(broom)
library(lmtest)
library(plm)
```

```{r, show_col_types = FALSE}
#| echo: FALSE
#| output: FALSE
#| label: Datasets and variable mutations
# Loading datasets
# Country code list: "IT", "SE", "BE", "AT", "HR", "RS", "BA", "BG", "DE")
# 
nama_10r_3gdp_linear_csv <- read_csv("nama_10r_3gdp_linear.csv.gz", 
    na = "NA")
demo_r_pjanaggr3_linear_csv <- read_csv("demo_r_pjanaggr3_linear.csv.gz", 
    na = "NA")
roads <- read_csv("roads.gz")
educ <- read_csv("educ.gz")
aream2 <- read_csv("aream2.gz")

# Subset of countries from 2000 to 2020
# Filtering geo = 5 to only get NUTS3 level data
gdp_filtered <- nama_10r_3gdp_linear_csv |> 
  filter(
    nchar(geo) == 5, 
    unit == "MIO_EUR", 
      TIME_PERIOD %in% c(2000:2020),
    str_sub(geo, start = 1L, end = 2L) %in% c("IT", "SE", "BE", "AT", "HR", "RS", "BA", "BG", "DE")
    ) |> 
  select(
    year = TIME_PERIOD, 
    geo, GDP = OBS_VALUE
    ) 

# Filtering population demo for nuts3 countries and years
# Filtering sex = T to only get the total of both genders
# Filtering age = TOTAL.
pop <- demo_r_pjanaggr3_linear_csv |> 
    filter(
      nchar(geo) == 5,
      sex == "T",
      age == "TOTAL",
      TIME_PERIOD %in% c(2000:2020), 
    str_sub(geo, start = 1L, end = 2L) %in% c("IT", "SE", "BE", "AT", "HR", "RS", "BA", "BG", "DE")
    ) |> 
  select(
    year = TIME_PERIOD, 
    geo, Population = OBS_VALUE
    ) 

# Merging the two datasets
merged_data <- merge(gdp_filtered, pop, by = "geo") |> 
  select(
    -year.y,
    Year = year.x,)

# merging the two datasets from eurostat and removing NA and zero values
merged_data <- merge(gdp_filtered, pop, by = c("geo","year"), all = TRUE) |> 
filter(!is.na(Population),
         Population != 0,
         GDP != 0, 
         GDP != "NA"
)
# Generating the GDP per capita variable
merged_data <- merged_data |> 
  mutate(
    GDPpcn3 = GDP / Population
  )
# Adding GDP variable by deviding gdp on population
merged_data <- merged_data |> 
  mutate(GDPpcn3 = (GDP / Population)*1000000)

# Calculating GINI in nuts3 data for nuts2 regions to measure inequity on a nuts2 scale
merged_data <- merged_data |> 
 mutate(
    nuts2 = substr(geo, 1,4),
    nuts0 = substr(geo, 1,2)
 )

# Cleaning the road dataset by removing irrelevant data and NA values
roads <- roads |> 
  select(
    nuts2 = geo, Roadkm = OBS_VALUE, year = TIME_PERIOD
  ) 
roads <- roads |>
  filter(
    !is.na(Roadkm),
    Roadkm != 0
  ) 
# Cleaning education dataset renaming variables
educ <- educ |> 
  filter(sex == "T") |> 
  select(
    nuts2 = geo, age, year = TIME_PERIOD, education = OBS_VALUE, level = isced11
  ) |> 
  filter(nuts2 != "NA", age != "NA", year != "NA", education != "NA")
  
# We are only looking for data for College education (ED5-8) and we devide education by 100 to get the percentages on percentage form.
educ <- educ |> 
  mutate(
    education = education/100
  ) |> 
  filter(level == "ED5-8") 

# Aream2 refers to the dataset containing area data for each nuts3 region measured in squared kilometres
aream2 <- aream2 |>
    mutate(
    year2 = 2010
  ) |> 
   select(
    nuts2 = geo, year = year2, area = OBS_VALUE
  ) 
# We noticed the dataset contained age groups, and two of those groups contained much of the same data: age 25-34 and 30-34. This created issues as some of these observations would be counted twice. We therefore decied to remove the group 30-34.
educ <- educ |> 
  filter(
    !age %in% "Y30-34"
  ) |> 
  mutate(
     nuts2 = substr(nuts2, 1,4),
  ) |> 
  group_by(nuts2) |> 
  mutate(
    sumeduc = sum(education, na.rm = TRUE)
  ) |> 
    slice(1) |> 
    ungroup() |> 
  select(-age)

merged_data <- merged_data |> 
  filter(!is.na(Population),
         Population != 0,
         GDPpcn3 != 0, 
         GDPpcn3 != "NA"
  ) |> 
  mutate(
         GDPpcn2 = mean(GDPpcn3), 
         popn2 = sum(Population),
         GDPn2 = sum(GDP),
         numberofregions = n_distinct(geo)
         ) 
 # select(nuts0, nuts2, geo, year, GDP, Population, GDPpcn3, gini_n2, numberofregions, GDPn2, GDPpcn2, popn2) 


```

# Introduction

Bakgrunn:

Objectives; Outline the main objectives and research questions addressed in Assignments 1, 2, and 3.

**Significance:** Highlight the importance and relevance of the research undertaken.

Snakk om viktigheten til hvorfor se på Gdp og ulikhet, andre ting som kan påvirke som; vei, utdanning, motorvei.

Forklar at noen land er rik og noen er fattig.
For å belyse dette på en god måte bør man bruke land med mange opservasjoner.
Vi ser på Tyskland og Italia pga de har ulik økonomi & industri.

# Literature Review

Regional inequality shows variation in regional GDP per capita, and according to @lessmann2017, regional inequality occurs when one region experiences different assumptions than other regions.
Moreover, when the level of economic development is high, there is significant regional inequality [@lessmann2017].
According to @williamson1965, one crucial difference that leads to regional inequality is the access to natural resources.
Regions rich in natural resources grow faster than regions in the rest of the country, which results in inequality.
Furthermore, openness is another critical element of why regional inequality occurs.
A region with more significant access to the international trade market than other regions with limited access will gain more from international trade if international trade costs decrease [@lessmann2017].

Moreover, openness can also contribute to foreign investors investing in a more attractive region, e.g., access to natural resources.
In the end, this led to an imbalance in regional equality.
Additionally, mobility can provide regional inequality through differences in transport costs from one region to another [@lessmann2017].
The differences in transport costs are caused, e.g. by fuel consumption per kilometre.
 

Furthermore, another significant element creating regional inequality is bureaucracy, policy and stability in a country [@lessmann2017].
Civil war affects the country's balance of regional equality and creates different assumptions.
An example is regions in a country that experience increasing aid.
Receiving assistance from foreign aid organisations creates inequality.
Lastly, @lessmann2017 state that an area where ethnic groups dominate as a minority can result in regional inequity.

Based on the research conducted by @lessmann2017, considering regional inequities is essential since it can influence economic outcomes.
The research shows many examples of high- and low-income countries experiencing unbalanced regional development that results in income inequality [@lessmann2017].

### *Research gap*

While the existing literature, as synthesized from Lessmann's (2017) work, provides valuable insights into the determinants of regional inequality, a research gap emerges in the specific context of this paper.
Lessmann's research predominantly covers the periods from 1992-2012, offering a comprehensive understanding of the broader factors influencing regional disparities.
However, this paper focus on a more localized and contemporary perspective, zooming in on the year 2010 and extending the analysis to encompass the years 2000-2020.

The research gap lies in the need for a nuanced examination of the interplay between sub-national GDP per capita and inequality within the specified subset of European countries, concentrating particularly on the year 2010.
While Lessmann's work sheds light on overarching determinants, the specific dynamics of this relationship within the unique economic, political, and social contexts of the chosen countries during the specified timeframe remain underexplored.

Furthermore, the literature review by Lessmann primarily touches on broader factors influencing regional inequality, creating an opportunity for a more detailed investigation into the nuanced developments that occurred post-2012.
This paper aim to contribute to filling this research gap by providing an in-depth analysis of regional development and inequality dynamics within the outlined subset of European countries, considering the distinctive contexts that may have shaped regional disparities during and after the year 2010.

# Data and Methodology

**Data Sources:**

By using Eurostat, we have downloaded data containing GDP and population for each country in the EU from year 1990 to 2023.
However, we are only interested in the following countries from 2000 to 2020:

-   Austria (AT)
-   Belgium (BE)
-   Bosnia and Herzegovina (BA)
-   Bulgaria (BG)
-   Croatia (HR)
-   Germany (DE)
-   Italy (IT)
-   Serbia (RS)
-   Sweden (SE)

*The first dataset we downloaded from Eurostat was **demo_r_pjanaggr3,** which contains population data from Europe. In our case, we have selected population data from Sweden, Italy, Belgium, Austria, Croatia, Serbia, Bosnia and Herzegovina, Germany. According to @eurostat2021, the dataset of demography is a set of statistical numbers each country in Europe sends yearly to Eurostat by 31 December of the following calendar year. Furthermore, the definition of "population" is, according to @eurostat2021, all persons having their residences in a member state, including all live births and deaths during the year when the statistical numbers are heading to Eurostat. Moreover, the demographic data at a regional level are separated into different groups named NUTS, which are defined as nomenclature for territorial units for statistics [@eurostat2021]. The purpose of the NUTS function is to subdivide the territory of the European Union into 104 regions at NUTS level 1 and break it down by to 281 at NUTS level 2 and 1348 at NUTS level 3 [@eurostat2021]. In the beginning of this paper, we have focused on the numbers of NUTS 3 level, but the dataset containing population data has been broken down by sex and broad age groups (0-14, 15-64 and 65 or more).*

*The following dataset we downloaded from Eurostat was the **nama_10r_3gdp dataset**. Furthermore, this dataset is also broken down to NUTS level 3 which focus on GDP data from the sub-regions in Sweden, Italy, Belgium, Austria, Croatia, Serbia, Bosnia and Herzegovina, Germany. According to @eurostat2023, GDP (Gross domsetsic product) at market prices is defined as the final result of the production activity of resident producer units [@eurostat2023].*

### Choice of countries:

```{r}
#| echo: FALSE
#| tbl-cap: Number of observations for each country
# Generates descriptive statistics for variables in plot for AT

merged_data |> 
  group_by("Country code" = nuts0) |> 
  summarize("Number of observations" = n()) |> 
  ungroup()


```

The table above provides a summary of all observations in each country we're considering for our paper.
It's crucial to highlight that our article's analysis deliberately omits the countries Croatia, Serbia, and Bosnia and Herzegovina.
This choice is driven by the constraints imposed due to either a lack of observations or an extremely limited dataset for these particular nations.
Specifically, Bosnia and Herzegovina are excluded due to the absence of observations.
For Serbia, the available data only spans from 2017 to 2020, which limits the comprehensive analysis across the entire study period.
Croatia, on the other hand, lacks significant data for various sub-regions, further contributing to its exclusion from our focused investigation.
Austria, Belgium, Bulgaria, Germany, Italy, and Sweden are selected for inclusion in the paper.
However, the primary focus will be on Germany and Italy, given their status as the largest countries in the dataset.

**Methodological Approach:**

#### GDP per capita calculation

In order to visualize the GDP per capita, we have merged the two datasets together and added a new variable that executes this formula in order to generate the GDP per capita for every country.

$y_i = \frac{\text{GDP}_i}{\text{population}_i} * 10^6$

It is worth noting that the GDP data from Eurostat is represented in million euros.
In order to better understand the graphs we have produced, we decided to multiply by one million, so that all numbers in the graph containing the GDP per capita is in full Euros.

GDP or Gross Domestic Product is a measure of value creation in a country.
This is described by Eurostat to be "a measure of economic activity, defined as the value of all goods and services produced minus the value of any goods or services used in their creation" @eurostat2023.
How Eurostat calculates the annual growth rate in GDP "comparisons of the dynamics of economic development both over time and between economies of different sizes" @eurostat2023.
To measure the growth rate of GDP over time "in volume, GDP in current prices is valued at the prices of the previous year, and the volume changes thus calculated are imposed on the level of a reference year; this is called a chain-linked series. Consequently, price movements will not inflate growth" @eurostat2023.

#### Gini coefficient calculation

The Gini coefficient is a measure of economic inequality within a population, and it is used to assess the distribution of income or wealth among individuals or households.
The formula below is used for the population-weighted Gini coefficient for GDP at the NUTS2 level in various European regions.

$GINW_j=\frac{1}{2 \bar{y_j}} \sum_{i}^{n_j}\sum_{l}^{n_j}\frac{p_i}{P_j} \frac{p_l}{P_j} |y_i-y_l|$

The Gini coefficient is calculated by summing the absolute differences in GDP per capita between all pairs of sub-regions, weighted by the products of their populations and the total population.
The components of the formula consist of the following:

-   $GINIW_j$: Represents the population-weighted Gini coefficient for a specific region or country (indexed by ($j$).

-   $y̅j$: This is the avarage GDP per capita in the region or country $j$.

-   $n_j$: The number of observations (sub-regions) in the region $j$.

-   $i,l$: Indices for individual observations (sub-regions) within the region or country $j$.

-   $p_i, p_l$: The poppulations of sub-regions $i$ and $l$ within the region or country $j$.

-   $P_j$: The total population of the region or country $j$.

-   $y_i, y_l$: The GDP per capita of sub-regions $i$ and $l$ within the region or country $j$.

    The Gini coefficient is calculated by summing the absolute differences in GDP per caita between pairs of sub-regions $(i, l)$, weighted by the products of their populations $(P_j)$.
    The result is normalized by twice the avarage GDP per capita $(2y̅_j)$.

A Gini coefficient close to 0 suggests a more equal distribution of income or wealth among the population.
Societies with low Gini coefficients generally exhibit less economic inequality, with resources more evenly distributed and a larger middle class.
Conversely, a Gini coefficient close to 1 indicates high income or wealth inequality.
In societies with high Gini coefficients, a significant portion of income or wealth is concentrated among a small percentage of the population, leading to pronounced disparities

The focus in this case is on a weighted Gini coefficient that considers both GDP per capita and population.
This approach aims to capture the true Gini coefficient, considering the significance of the population variable in explaining regional inequality.
The analysis is conducted at a NUTS2 level for various European regions, including countries such as Austria, Belgium, Bosnia and Herzegovina, Bulgaria, Croatia, Germany, Italy, Serbia, and Sweden.

### 

```{r}
#| echo: false
#| label: Gini coefficient
# Grouping NUTS3 to NUTS2
# Adding the gini coefficient to the gpd pr capita variable and weighing by population (grouped by nuts2)
merged_data <- merged_data |> 
  group_by(nuts2, year) |> 
  mutate(gini_n2 = gini.wtd(GDPpcn3, Population),
         GDPpcn2 = mean(GDPpcn3), 
         popn2 = sum(Population),
         GDPn2 = sum(GDP),
         numberofregions = n_distinct(geo)
         ) |> 
  slice(1) |> 
  ungroup() |> 
  select(nuts0, nuts2, geo, year, GDP, Population, GDPpcn3, gini_n2, numberofregions, GDPn2, GDPpcn2, popn2) 
  # number of regions is wrong, want to show number of nuts3 regions in a nuts2 region as a vector
```

**Methodological Approach:**

Before selecting the appropriate method for our analysis, it is imperative to scrutinize GDP as the dependent variable and inequality (GINI) as the independent variable.
This entails a thorough examination of the components encompassed within GDP and the factors influencing the GINI index.
Understanding the intricacies of these variables is crucial for making informed decisions regarding the analytical approach to be employed.

The first step is to estimate a simple linear regression model for the year 2010, with regional development, measured in GDP per capita, as the independent variable and regional inequality, measured in Gini, as the dependent variable.
This is because we want to see the impact a change in the regional development will have on inequity in a given country.

Lessmann and Seidel discuss that the national development level can be an outcome of regional inequalities.
Our aim is to showcase this with regional development (GDP per capita​) as the independent variable and regional inequality (gini_n2) as the dependent variable.

Our aim is to explain the regional inequalities with regional development as the explanatory variable.
This brings forward the following expression:

$$ Orginal Model: Inequality_i = ß_0 + ß_1Devolopment_i $$

*"Existing studies have shown a serious bias towards middle -- and high -income countries entire population"* [@lessmann2017].
We therefore use the level of economic development measured as log by the GDP pr capita measured in euros in million\`s.
The reason why we use GDP per capita on a regional level is because the of GDP pr capita and GDP has a different meaning.
GDP measure a country as a hole, where the GDP per capita is measuring the productivity of the population.

We will reduce bias by looking at country's entire populations through the GDP per capita of Italy and Germany.
The reason we choose the selected countries is because they are the largest and have the most observations, which reduces potential bias.

We have opted to employ a logarithmic model instead of the original model.
This decision is grounded in the observation that the logarithmic model better aligns with the characteristics of our dataset, offering a more accurate representation because of potential skewed data.
Table A.1 and A.
2 in the Appendix illustrate the differences between the orginal model and the log original model.

Using a logarithmic model creates a asymptotic behavior for the regression line.
The non linear relationship between regional inequality and regional development will either go towards full inequality, or towards zero inequality, but will never completely reach the maximum or minimum (1 or 0).
In order to calculate this, we use the following formula:

$$ Inequality_i = ß_0 + ß_1 log(Development_i) + ε_i $$

By exploring different functional forms, we are able to determine the best functional form for our estimates by looking at descriptive statistics to justify our selections.
We found no significance by including the original function, and thus, concluded to utilize a logarithmic function.

*Theory:*

An increase in GDP per capita will lead to a decrease in the Gini coefficient (regional inequity).
The basis for this theory is that an increase of ten thousand euros (one percent of one million) in GDP per capita will have a greater effect on the regions that stand out.
There comes a point where an increase in GDP per capita will have a greater impact on those with a small GDP per capita, versus those with a larger GDP per capita.
The reason for this is because the effect of the increase in GDP per capita hits those with larger GDP per capita different than those with a smaller GDP per capita.

## Cross - sectional estimates: motorvei og utdanning

In our analysis, we focus on a specific year, 2010, to conduct cross-sectional estimates for the countries of Italy and Germany.
This targeted approach allows us to capture a snapshot of the socio-economic landscape during that particular period and explore the dynamics influencing inequality within these nations.
To delve deeper into the drivers of inequality, we introduce additional variables such as education (educ) and regional area, aiming to discern their potential impact on the relationship between a percentage increase in GDP per capita and inequality.
The inclusion of education as a variable provides insights into the role of human capital in shaping regional disparities, while accounting for regional area allows us to consider geographical factors that might contribute to varying levels of inequality.
By employing the year 2010 as a focal point and augmenting our models with these pertinent variables, we seek to unravel the nuanced interplay between economic development, education, and spatial dimensions in shaping inequality trends within the regions of Italy and Germany.

*Theory:*

We believe that if a region has a big difference in the level of education among subregions, this will increase the regional inequality based on the assumption that a subregion with higher educated citizens will typically earn more than subregions with lesser educated citizens, thus increasing the difference in GDP per capita on the regional level.
Another assumption that can explain the increased expectancy, is that higher educated citizens tend to have a higher probability of centralizing towards city centers, contrary to less educated citizens.

The centralization assumption is also true for the area of the regions.
If a region is large, the probability for centralization could be bigger, based on factors such as job markets, mobility and distance between cities or areas.
This is the basis of why we chose to add the highway infrastructure variable, as a higher level of infrastructure might decrease the likelihood for centralization as mobility increases.

## Exploring alternative functional forms

Building on our prior analysis that focused on the variables education (educ), area, and road length (roadkm) in the specific context of the year 2010, we will now narrow our scope.
For the period spanning 2000-2020, our attention turns to a more focused examination of the relationship between log(GDP) and inequality in Germany and Italy.
In this phase, we will utilize alternative methods to delve into the intricate dynamics of how log(GDP) influences regional inequality across these two nations.
This approach allows us to explore nuanced patterns and evolving trends in the interaction between economic development and inequality over the course of the past two decades.

*Functional form exploration*

*Quadratic*

Using a quadratic model shows the non linear relationship between regional inequality and regional development with either a U-shaped line, or a inverted u-shaped line.
In order to calculate this, we use the following formula:

$$ Inequality_i = ß_0 + ß_1(logDevelopment)^2 $$

We believe that the regional development in a quadratic model will have a concave shape as we believe that an increase in GDP per capita will have a increased effect on inequality but a decreased effect as the number increases.

*Cubic*

Cubic forms accommodate more complex non-linear relationships, capturing patterns where the impact of development on inequality changes direction multiple times.

The instruction asks you to explore these forms and select two that may provide a better fit.
This typically involves estimating each model, assessing goodness-of-fit measures, and comparing the models to determine which ones better capture the underlying relationship in your data.

$$ Inequality_i = ß_0 + ß_1(logDevelopment)^3 $$

We believe that the regional development in a Cubic model will have a concave shape as we believe that an increase in GDP per capita will have a increased effect on inequality but a decreased effect as the number increases.

Teori: at stiger/avtar/stiger

Skriv om at vi brukte logaritmic, quadratic + vi må tilføre quic som metode.
Dette gjøres for å se hvilke metode som er "Best fit" og begrunn valg for de ulike metodene.

## Fixed Effects

Til slutt skal vi bruke en metode som går ut på å se på fixed effekts gjennom et panel, hvor de ulike fixed effectsene er; Nuts 0, Nuts2, year og nuts 2 og year sammen

In our panel data analysis, we adopt a robust methodology by incorporating fixed effects to mitigate potential sources of bias and better capture the underlying dynamics of our data.
Specifically, we include NUTS 0 (country-level), NUTS 2 (sub-regional), and year fixed effects in our models.
The inclusion of NUTS 0 fixed effects allows us to account for country-specific heterogeneity, capturing unobserved factors that might influence the relationship under investigation.
Additionally, NUTS 2 fixed effects enable us to control for sub-regional variations, offering insights into localized patterns.
Furthermore, by incorporating year fixed effects, we address temporal trends and time-specific factors that may impact our dependent variable.
To delve deeper into the nuanced interplay between sub-regional dynamics and temporal effects, we extend our analysis by combining NUTS 2 and year as joint fixed effects.
This comprehensive approach ensures a thorough exploration of the intricate relationships within our panel dataset, enhancing the robustness and reliability of our findings.

### **Classical assumptions OLS for MLR**

There are underlying assumptions in statistical analysis like ordinary least squares regression (OLS).
OLS yields the best estimates when these conventional presumptions hold true.
OLS regression is based on six traditional assumptions.
Our models are unbiased if the first four conditions are met.
Below is a list of all six presumptions:

1.  Linearity: There must be a linear relationship between the dependent variable (regional GINI) and independent variable (GDP per capita).
    We can read from the two scatterplots below, @fig-scatterplot-RL-DE and @fig-scatterplot-RL-IT, that the relationship for both Germany and Italy seems to be linear, with only some few outliers.

2.  Sample variation: We can also see from @fig-scatterplot-RL-DE and @fig-scatterplot-RL-IT that there is variation in the independent variable (GDP per capita).

3.  Random sampling: There is no random sampling of the population as we are looking at the entire population.

4.  Exogeneity: As inequality is closely related to the development of a country as undeveloped countries typically have higher levels of inequality, there is likely concerns of endogenity.
    This means that there is likely a correlation between the dependent and independent variable.

5.  Homoskedasticity: To fulfill the OLS assumptions, variance in the observations needs to be equal, known as homoskedasticity.
    There are many tests for heteroskedasticity.
    In each case, the null hypothesis is homoskedasticity and the alternative is heteroskedasticity.
    If the variance in the observations are not equal, heteroskedasticity could be present.
    This may result in incorrect standard errors that are computed for the least squares estimators, and could lead to incorrect conclusions.
    In order to check for heteroskedasticity, we utilize the Breusch-Pagan test, **see appendix model X**

6.  Normality: In the context of ordinary least squares (OLS) assumptions, the normality criteria demands that the error term adheres to a normal distribution with an expected value of zero.
    This implies that the discrepancies between observed and predicted values, known as residuals, should have a mean of zero, ensuring a homoskedasticity error term.
    However, it is imperative to note that the failure of the error term to equal zero implies a departure from normality in the population error term within the dataset, thus rendering the normality assumption unfulfilled.

# Empirical Findings

Hovedmodell;

```{r}
#| echo: FALSE
#| tbl-cap: The effect of regional development on inequality
#| label: Parta
# Fit the three models
partaDE <- lm(gini_n2 ~ log(GDPpcn2), data = subset(merged_data, nuts0 == "DE" & gini_n2 > 0))
partaIT <- lm(gini_n2 ~ log(GDPpcn2), data = subset(merged_data, nuts0 == "IT" & gini_n2 > 0))

huxreg(DE = partaDE, IT = partaIT, statistics = c("Number of observations" = "nobs", "r.squared","adj.r.squared", "statistic", "P-value F-test" = "p.value"), 
       stars = c("*" = 0.1, "**" = 0.05, "***" = 0.01),
       note = "Note): {stars} T statistics in brackets.")
```

## **Cross-sectional Estimates:** Summarize essential results obtained from the cross-sectional analysis in Assignment 2.

Modellen fra Assignment 2; 2010; Denne bruker vi for å se på et spesifikt år, videre skal vi

```{r}
#| echo: false
#| cap-location: bottom
#| tbl-cap: "Linear regression model year 2010 for Germany and Italy"
# Estimating linear regression models for Germany and Italy with Gini and GDP per capita.
# By using the formula we observed skewed data and mitigated the issue by log transforming the independant variable. 
lmDE <- lm(gini_n2 ~ log(GDPpcn2), subset(merged_data, year == 2010 & nuts0 == "DE" & gini_n2 > 0))
lmIT <- lm(gini_n2 ~ log(GDPpcn2), subset(merged_data, year == 2010 & nuts0 == "IT" & gini_n2 > 0))

huxreg(DE = lmDE, IT = lmIT, statistics = c("Number of observations" = "nobs", "r.squared","adj.r.squared", "statistic", "P-value F-Test" = "p.value"), 
       stars = c("*" = 0.1, "**" = 0.05, "***" = 0.01),
       note = "Note): {stars} T statistics in brackets.")
```

In the table above we see the coefficients, standard errors, and significance levels (indicated by asterisks) for a simple linear regression model for the year 2010.
The model has GDP per capita as the independent variable and regional Gini as the dependent variable for both Germany (DE) and Italy (IT).

For Germany (DE), the intercept coefficient is -2.129\*\*, which indicates a high level of statistical significance at the 1% level.
This means that when GDP per capita is zero, the estimated Gini coefficient for Germany is -2.129.
The standard error of the intercept is 0.755, indicating the precision of the estimate.

For Italy (IT), the intercept coefficient is -0.478 and is not significant.
This means that when GDP per capita is zero, the estimated Gini coefficient for Italy is 0.478.
The standard error of the intercept is 0.433.

For Germany (DE), the coefficient for log(GDPpcn2) is 0.222\*\*.
This implies a high level of statistical significance at the 1% level.
In other words, there is strong evidence of a positive linear relationship between the GDP per capita and the Gini coefficient in Germany in 2010.
The standard error associated with the coefficient is 0.073, which indicates the precision of this relationship.

For Italy (IT), the coefficient for log(GDPpcn2) is 0.052.
The absence of asterisks suggests that this coefficient is not statistically significant at commonly used significance levels.
This implies that there is no strong statistical evidence of a linear relationship between the GDP per capita and the Gini coefficient in Italy in 2010.
The standard error of the coefficient is 0.043, providing a measure of the precision of this relationship.

## **Model Diagnostics**

R-squared (r.squared) is a measure of how well the independent variable(s) explain the variation in the dependent variable.
For Germany, the R-squared is 0.229, indicating that approximately 22.9% of the variation in the Gini coefficient can be explained by variations in log(GDPpcn2).
For Italy, the R-squared is 0.090, suggesting that about 9.0% of the variation in the Gini coefficient can be explained by variations in log(GDPpcn2).

Adjusted R-squared (adj.r.squared) is a modified version of R-squared that accounts for the number of independent variables.
It penalizes the inclusion of unnecessary variables.
For both Germany and Italy, the adjusted R-squared is lower than the R-squared, indicating that some variables may not be contributing significantly to the model.

The statistic value (statistic) and p-value (p.value) are typically used to test the overall significance of the regression model.
For Germany, the t-statistic is 9.183, and the associated p-value is 0.005, indicating that the model is statistically significant at the 0.05 significance level.
For Italy, the t-statistic is 1.485, and the associated p-value is 0.242, suggesting that the model is not statistically significant at the 0.05 significance level.

Visualusering av modellen i assignment 2;

```{r}
#| echo: FALSE
#| label: fig-scatterplot-RL-DE
#| cap-location: bottom
#| fig-cap: "Regression model for the year 2010 for Germany with GDP per capita (x) and regional inequality (Gini/y)."
# Visualizing the linear regression of the gini coefficient by GDP per capita for Germany
merged_data_filtered <- merged_data %>%
  filter(str_detect(geo, "DE") & year == 2010 & gini_n2 > 0)

ggplot(merged_data_filtered, aes(x = log(GDPpcn2), y = gini_n2)) +
  geom_point() +
  geom_smooth(method = "lm", formula = y ~ poly(x,2), se = F, span = 1) +  
  labs(
    x = "GDP per capita nuts2",
    y = "Gini Index (n2)"
  )
```

In @fig-scatterplot-RL-DE, we plot GDP per capita on nuts 2 level (x) against Gini (y) and illustrate the estimated relationship with a blue line.
The inequality (y-axis) starts off with a slight decrease as the GDP per capita (x-axis) increases.
However, inequality seem to increase.

```{r}
#| echo: FALSE
#| label: fig-scatterplot-RL-IT
#| cap-location: bottom
#| fig-cap: "Regression model for the year 2010 for Italy with GDP per capita (x) and regional inequality (Gini/y)."
# Visualizing the linear regression of the gini coefficient by GDP per capita for Italy
merged_data_filtered <- merged_data %>%
  filter(str_detect(geo, "IT") & year == 2010 & gini_n2 > 0)

ggplot(merged_data_filtered, aes(x = log(GDPpcn2), y = gini_n2)) +
  geom_point() +
  geom_smooth(method = "lm", formula = y ~ poly(x,2), se = F, span = 1) +  # Specify the formula
  labs(
    x = "GDP per capita nuts2",
    y = "Gini Index (n2)"
  )
```

In @fig-scatterplot-RL-IT, we plot GDP per capita on nuts 2 level (x) against Gini (y) and illustrate the estimated relationship with a blue line.
Italy has a bigger decrease in inequality compared to Germany.
The inequality (y-axis) starts off with a decrease as the GDP per capita (x-axis) increases.
However, at some point it increases again meaning an increasing GDP per capita result in bigger regional inequality.

Assigment 2; her legges variablene roads, area og educ til.

To further understand the inequality on a regional level it is necessary to look for other variables that can contribute to explaining the Gini coefficient.
Variables that may help explain this is the educational level of the population, the area of the region as well as the amount of highway infrastructure that a region has.
The education data gathered is measured in the percentage of the population that has completed a higher education level (ED5-8) from the age of 20 to 65.
The area data is measured in squared kilometers and the road data is the total amount of highway infrastructure that a region has.

If a region has a big difference in the level of education among subregions, we believe this will increase the regional inequality.
Human capital is one of the most important determinants of differences in reginal development within countries @lessmann_and_seidel2017.
*"Human capital creates positive externalities, which can also spill over reginal boundaries"* @lessmann_and_seidel2017.
Unfortunately, this data is not available for Germany and Italy.
We therefore fall back upon the average quality of human capital within Germany and Italy, as measured by the education level ED5-8 to look if a percentage of higher education increase inequality in a region.

We believe that if a region has a big difference in the level of education among subregions, this will increase the regional inequality based on the assumption that a subregion with higher educated citizens will typically earn more than subregions with lesser educated citizens, thus increasing the difference in GDP per capita on the regional level.
Another assumption that can explain the increased expectancy, is that higher educated citizens tend to have a higher probability of centralizing towards city centers, contrary to less educated citizens.

The centralization assumption is also true for the area of the regions.
If a region is large, the probability for centralization could be bigger, based on factors such as job markets, mobility and distance between cities or areas.
This is the basis of why we chose to add the highway infrastructure variable, as a higher level of infrastructure might decrease the likelihood for centralization as mobility increases.
  

### 2. **Multiple Linear Regression Model**

```{r}
#| echo: FALSE
# Adding the new variables to the main dataset
merged_data <- left_join(merged_data, aream2, by = c("nuts2", "year"))

merged_data <- left_join(merged_data, educ, by = c("nuts2", "year"))

merged_data <- left_join(merged_data, roads, by = c("nuts2", "year"))
```

```{r}
#| echo: FALSE
#| label: Dataset for 2010 variables
# Creating a new dataset that only contains Germany and Italy for the year 2010.
merged2010 <- merged_data |> 
  filter(year == 2010) |> 
  select(nuts2, year, everything()) |> 
  select(nuts2, year, GDPpcn2, gini_n2, education, area, Roadkm) |> 
  filter(str_detect(nuts2, "IT|DE"), nchar(nuts2) == 4) |> 
  filter(
    Roadkm != "NA",
    Roadkm != 0
  ) |> 
  mutate(
    nuts0 = substr(nuts2, 1,2)
  ) |> 
    mutate(
    roadratio = Roadkm/area
  ) |> 
  select(
    nuts0, nuts2, everything()
  )
```

Her har vi lagt til motorvei pr areal og motorvei for å se om dette øker forklaringsgraden?

## Alternative functional forms;

### Logaritmic;

```{r}
#| echo: FALSE
#| tbl-cap: The effect of log regional development on inequality
lmlogDE <- lm(gini_n2 ~ log(GDPpcn2), subset(merged_data, nuts0 == "DE" & gini_n2 > 0))

lmlogIT <- lm(gini_n2 ~ log(GDPpcn2), subset(merged_data, nuts0 == "IT" & gini_n2 > 0))


huxreg("Model 1 DE" = lmlogDE, "Model 1 IT" = lmlogIT, statistics = c("Number of obervations" = "nobs","r.squared","adj.r.squared", "statistic", "P-value F-Test" = "p.value"), 
       stars = c("*" = 0.1, "**" = 0.05, "***" = 0.01),
       note = "Note): {stars} T statistics in brackets.")
```

### Quadratic;

Formaterer litt før quadratic

```{r}
#| echo: false
# Mutated a new variable logGDPpcn2quad = logGDPpcn2^2
merged_data <- merged_data |> 
  mutate(
    logGDPpcn2 = log(GDPpcn2),
    logGDPpcn2quad = logGDPpcn2^2,
    logGDPpcn2cubic = logGDPpcn2^3
  )
```

Lager quadratic modell;

```{r}
#| echo: FALSE
#| tbl-cap: The effect of log squared regional development on inequality
lmquadDE <- lm(gini_n2 ~ logGDPpcn2quad, subset(merged_data, nuts0 == "DE" & gini_n2 > 0))

lmquadIT <- lm(gini_n2 ~ logGDPpcn2quad, subset(merged_data, nuts0 == "IT" & gini_n2 > 0))

#Tar denne vekk fordi vi ikke skal legge til sverige før i panel#lmquadSE <- lm(gini_n2 ~ logGDPpcn2quad, subset(merged_data, nuts0 == "SE" & gini_n2 > 0))

huxreg("Model 1 DE" = lmquadDE, "Model 1 IT" = lmquadIT, statistics = c("Number of obervations" = "nobs","r.squared","adj.r.squared", "statistic", "P-value F-Test" = "p.value"), 
       stars = c("*" = 0.1, "**" = 0.05, "***" = 0.01),
       note = "Note): {stars} T statistics in brackets.")
```

### Cubic;

```{r}
#| echo: FALSE
#| tbl-cap: The effect of log squared regional development on inequality
lmCubicDE <- lm(gini_n2 ~ logGDPpcn2cubic, subset(merged_data, nuts0 == "DE" & gini_n2 > 0))

lmCubicIT <- lm(gini_n2 ~ logGDPpcn2cubic, subset(merged_data, nuts0 == "IT" & gini_n2 > 0))

#Tar denne vekk fordi vi ikke skal legge til sverige før i panel#lmquadSE <- lm(gini_n2 ~ logGDPpcn2quad, subset(merged_data, nuts0 == "SE" & gini_n2 > 0))

huxreg("Model 1 DE" = lmCubicDE, "Model 1 IT" = lmCubicIT, statistics = c("Number of obervations" = "nobs","r.squared","adj.r.squared", "statistic", "P-value F-Test" = "p.value"), 
       stars = c("*" = 0.1, "**" = 0.05, "***" = 0.01),
       note = "Note): {stars} T statistics in brackets.")
```

### Panel:

**Alternative Functional Forms and Panel Estimates:** Present the key insights derived from exploring alternative functional forms and panel estimates in Assignment 3.

Her skal vi visualisere hvilken modell som passer best og skrive om det. Her kommer et forslag med qudratic som utgangspunkt for tysklad og italia;

```{r}
#| echo: false
#| label: fig-logGDPpcn2DE
#| cap-location: bottom
#| fig-cap: "Scatter Plot for Germany with a regression line showing the relationship between the gini coefficient and GDP per capita."

merged_data |> 
  filter(numberofregions > 1, nuts0 == "DE") |> 
  ggplot(
    aes(
      x = logGDPpcn2,
      y = gini_n2
    )
  ) + geom_point() + geom_smooth(method = "lm", formula = y ~ poly(x,2), se = F, span = 1) 

```

Using a quadratic logarithmic model enables us to look at the non linear relationship between the two variables.
As seen in the figure, as the X-axis increases, so does the coefficient of regional development.
This suggests that the increase in regional development will have a growing impact on inequality.
While the coefficient is positive, a positive increase in GINI reflects a higher level of inequality.
This means that as the regional development in Germany increases, the effect it has on the level of inequality grows increasingly.

```{r}
#| echo: false
#| label: fig-logGDPpcn2IT
#| cap-location: bottom
#| fig-cap: "Scatter Plot for Italy with a regression line showing the relationship between the gini coefficient and GDP per capita."
merged_data |> 
  filter(numberofregions > 1, nuts0 == "IT") |> 
  ggplot(
    aes(
      x = logGDPpcn2,
      y = gini_n2
    )
  ) + geom_point() + geom_smooth(method = "lm", formula = y ~ poly(x,3), se = F, span = 1) 
```

The relationship between regional inequality and regional development in Italy illustrates a different relationship than Germany.
The non linearity of the model is greatly visualized as the convex shape means that the initial growth in regional development will have a decreased effect on inequality.
However, as this increases, so does the impact that regional development has on inequality, similar to Germany, but at a higher rate.

```{r}
#| echo: false
#| output: false
# filtering merged data 
pmerged <- merged_data |> 
  filter(!is.na(Population),
         Population != 0,
         GDPpcn3 != 0, 
         GDPpcn3 != "NA"
  ) |> 
group_by(nuts2, year) |> 
  slice(1) |> 
  ungroup() |> 
  select(nuts0, nuts2, geo, year, gini_n2, GDPpcn2, logGDPpcn2, logGDPpcn2quad, logGDPpcn2cubic, numberofregions) |> 
  filter(nuts0 == c("DE", "IT", "SE", "AT", "BE", "BG"))

```

Her er panelet vårt, rart med negativ r adjusted??
bare bruk vanlig r hilsen Andre!

```{r}
#| echo: false
# We look at the fixed effects of country, year and nuts2 for the models using robust standard errors. From plm1 to plm3 we look at the fixed effects seperately, plm4 looks at them jointly.

plm1 <- plm(gini_n2 ~ log(GDPpcn2) + logGDPpcn2quad + logGDPpcn2cubic, data = pmerged, index = c("nuts0"), model = "within",effect = "twoway") %>%
  coeftest(vcov. = vcovHC, type = "HC1", save = TRUE)

plm2 <- plm(gini_n2 ~ log(GDPpcn2) + logGDPpcn2quad + logGDPpcn2cubic, data = pmerged, index = c("year"), model = "within",effect = "twoway") %>%
  coeftest(vcov. = vcovHC, type = "HC1", save = TRUE)

plm3 <- plm(gini_n2 ~ log(GDPpcn2) + logGDPpcn2quad + logGDPpcn2cubic, data = pmerged, index = c("nuts2"), model = "within",effect = "twoway") %>%
  coeftest(vcov. = vcovHC, type = "HC1", save = TRUE)

plm4 <- plm(gini_n2 ~ log(GDPpcn2) + logGDPpcn2quad + logGDPpcn2cubic, data = pmerged, index = c( "year","nuts2"), model = "within",effect = "twoway") %>%
  coeftest(vcov. = vcovHC, type = "HC1", save = TRUE)
huxreg(plm1, plm2, plm3, plm4, statistics = c("Number of observations" = "nobs","r.squared","adj.r.squared", "statistic", "P-value F-Test" = "p.value"), 
       stars = c("*" = 0.1, "**" = 0.05, "***" = 0.01),
       note = "Note): {stars} T statistics in brackets.")
```

# Discussion

**Key Insights:** Synthesize and discuss the central insights emerging from the empirical findings.

Hetro/homo, hadde variablene motorvei/utdanning noe å si i år 2010 ( orginalmodell 2010) se hvilke del av teksten fra forige del som skal her for å diskutere ulike modeller.
her kommer vi frem til hvilke modell som er "best fit"

**Policy Implications:** Deliberate on the potential implications of your results for policy-making and practice in the realm of regional development and inequality.

Skriv noe om at panel kan være bra.
Si at vi her kan ta med landene vi har pga.
observasjoner ikke har like mye å si lengre, og forklar hvorfor dette ikke har like mye å si.

# Limitations and Future Research

**Research Limitations:** Acknowledge any constraints or limitations encountered during your analysis.

# Conclusion

**Summary:** Provide a succinct summary of the main findings and their significance.

**Final Reflection:** Briefly reflect on the research process and the contributions of your study to the field of regional development and inequality.

# References

```{r}

```

# Appendix

*A.1 Orginal- and logarithmic model for Germany*

```{r}
merged_data |> 
  filter(numberofregions > 1, nuts0 == "DE") |> 
  ggplot(
    aes(
      x = GDPpcn2,
      y = gini_n2
    )
  ) + geom_point() + geom_smooth(method = "lm", formula = y ~ x, se = F, span = 1) 

merged_data |> 
  filter(numberofregions > 1, nuts0 == "DE") |> 
  ggplot(
    aes(
      x = logGDPpcn2,
      y = gini_n2
    )
  ) + geom_point() + geom_smooth(method = "lm", formula = y ~ x, se = F, span = 1)
```

*A.2 Orginal- and logarithmic model for Italy*

```{r}
merged_data |> 
  filter(numberofregions > 1, nuts0 == "IT") |> 
  ggplot(
    aes(
      x = GDPpcn2,
      y = gini_n2
    )
  ) + geom_point() + geom_smooth(method = "lm", formula = y ~ x, se = F, span = 1) 

merged_data |> 
  filter(numberofregions > 1, nuts0 == "IT") |> 
  ggplot(
    aes(
      x = logGDPpcn2,
      y = gini_n2
    )
  ) + geom_point() + geom_smooth(method = "lm", formula = y ~ x, se = F, span = 1)
```

*A.3 Breusch-Pagan BP-Test*

```{r}
#| echo: false

# Testing for heteroskedasticity in the original models, logarithmic models and quadratic models.

# Original models
bp_pvalues <- c(
  bpDE = bptest(partaDE)$p.value,
  bpIT = bptest(partaIT)$p.value,
  
  #logarithmic models
  bplogDE = bptest(lmlogDE)$p.value,
  bplogIT = bptest(lmlogIT)$p.value,
  
  #Quadratic models
  bpquadDE = bptest(lmquadDE)$p.value,
  bpquadIT = bptest(lmquadIT)$p.value
  
)
print(bp_pvalues)
```

bp = Original models, log = logarithmic models, quad = quadratic models.
